{% extends "admin_base.html" %}

{% block title %}Reglages - Admin DISPARUS.ORG{% endblock %}

{% block page_title %}{% if get_locale() == 'fr' %}Reglages{% else %}Settings{% endif %}{% endblock %}
{% block page_subtitle %}{% if get_locale() == 'fr' %}Configuration de la plateforme{% else %}Platform configuration{% endif %}{% endblock %}

{% block admin_content %}
<form method="POST" class="space-y-6">
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-4 border-b border-gray-100 bg-gray-50">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                {% if get_locale() == 'fr' %}Parametres generaux{% else %}General settings{% endif %}
            </h2>
        </div>
        <div class="p-5 space-y-4">
            {% if settings_by_category and settings_by_category.get('general') %}
            {% for setting in settings_by_category.get('general', []) %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{{ setting.key }}</label>
                {% if setting.value_type == 'boolean' %}
                <select name="setting_{{ setting.key }}" class="w-full rounded-xl border-gray-200 text-sm">
                    <option value="true" {% if setting.value == 'true' %}selected{% endif %}>{% if get_locale() == 'fr' %}Oui{% else %}Yes{% endif %}</option>
                    <option value="false" {% if setting.value == 'false' %}selected{% endif %}>{% if get_locale() == 'fr' %}Non{% else %}No{% endif %}</option>
                </select>
                {% elif setting.value_type == 'text' %}
                <textarea name="setting_{{ setting.key }}" rows="3" class="w-full rounded-xl border-gray-200 text-sm">{{ setting.value or '' }}</textarea>
                {% else %}
                <input type="text" name="setting_{{ setting.key }}" value="{{ setting.value or '' }}" class="w-full rounded-xl border-gray-200 text-sm">
                {% endif %}
                {% if setting.description %}
                <p class="text-xs text-gray-500 mt-1">{{ setting.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
            {% else %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Nom du site{% else %}Site name{% endif %}</label>
                    <input type="text" name="setting_site_name" value="DISPARUS.ORG" class="w-full rounded-xl border-gray-200 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Email de contact{% else %}Contact email{% endif %}</label>
                    <input type="email" name="setting_contact_email" value="contact@disparus.org" class="w-full rounded-xl border-gray-200 text-sm">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Description du site{% else %}Site description{% endif %}</label>
                <textarea name="setting_site_description" rows="2" class="w-full rounded-xl border-gray-200 text-sm">Plateforme humanitaire citoyenne pour signaler et rechercher les personnes disparues en Afrique</textarea>
            </div>
            <div class="flex items-center gap-4">
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="setting_require_contribution_validation" checked class="rounded border-gray-300">
                    <span class="text-sm text-gray-700">{% if get_locale() == 'fr' %}Validation des contributions requise{% else %}Require contribution validation{% endif %}</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="setting_allow_anonymous_reports" checked class="rounded border-gray-300">
                    <span class="text-sm text-gray-700">{% if get_locale() == 'fr' %}Signalements anonymes{% else %}Anonymous reports{% endif %}</span>
                </label>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-4 border-b border-gray-100 bg-blue-50">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                {% if get_locale() == 'fr' %}SEO / Referencement{% else %}SEO / Search Engine Optimization{% endif %}
            </h2>
        </div>
        <div class="p-5 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Titre SEO{% else %}SEO Title{% endif %}</label>
                    <input type="text" name="setting_seo_title" value="{{ settings_by_category.get('seo', [{}])[0].value if settings_by_category else 'DISPARUS.ORG - Retrouver les personnes disparues' }}" class="w-full rounded-xl border-gray-200 text-sm" placeholder="Titre pour les moteurs de recherche">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Robots{% else %}Robots{% endif %}</label>
                    <select name="setting_seo_robots" class="w-full rounded-xl border-gray-200 text-sm">
                        <option value="index, follow">index, follow</option>
                        <option value="noindex, follow">noindex, follow</option>
                        <option value="index, nofollow">index, nofollow</option>
                        <option value="noindex, nofollow">noindex, nofollow</option>
                    </select>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Meta Description{% else %}Meta Description{% endif %}</label>
                <textarea name="setting_seo_description" rows="2" class="w-full rounded-xl border-gray-200 text-sm" placeholder="Description pour les resultats de recherche (max 160 caracteres)">Plateforme humanitaire citoyenne pour signaler et rechercher les personnes disparues en Afrique</textarea>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Mots-cles{% else %}Keywords{% endif %}</label>
                <input type="text" name="setting_seo_keywords" value="disparus, personnes disparues, Afrique, recherche, signalement" class="w-full rounded-xl border-gray-200 text-sm" placeholder="Mots-cles separes par des virgules">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}URL canonique{% else %}Canonical URL{% endif %}</label>
                    <input type="url" name="setting_seo_canonical_url" class="w-full rounded-xl border-gray-200 text-sm" placeholder="https://disparus.org">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Image OpenGraph{% else %}OpenGraph Image{% endif %}</label>
                    <input type="url" name="setting_seo_og_image" class="w-full rounded-xl border-gray-200 text-sm" placeholder="https://disparus.org/og-image.jpg">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Google Analytics ID</label>
                    <input type="text" name="setting_seo_google_analytics" class="w-full rounded-xl border-gray-200 text-sm" placeholder="GA-XXXXXXXXX">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Google Tag Manager ID</label>
                    <input type="text" name="setting_seo_google_tag_manager" class="w-full rounded-xl border-gray-200 text-sm" placeholder="GTM-XXXXXXX">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Twitter / X Handle{% else %}Twitter / X Handle{% endif %}</label>
                <input type="text" name="setting_seo_twitter_handle" class="w-full rounded-xl border-gray-200 text-sm" placeholder="@disparus_org">
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-4 border-b border-gray-100 bg-purple-50">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                {% if get_locale() == 'fr' %}Scripts personnalises{% else %}Custom Scripts{% endif %}
            </h2>
        </div>
        <div class="p-5 space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Code dans &lt;head&gt;{% else %}Code in &lt;head&gt;{% endif %}</label>
                <textarea name="setting_seo_head_scripts" rows="4" class="w-full rounded-xl border-gray-200 text-sm font-mono text-xs" placeholder="<!-- Scripts, meta tags, CSS a inserer dans le head -->"></textarea>
                <p class="text-xs text-gray-500 mt-1">{% if get_locale() == 'fr' %}Ce code sera insere avant &lt;/head&gt;{% else %}This code will be inserted before &lt;/head&gt;{% endif %}</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Code dans &lt;body&gt;{% else %}Code in &lt;body&gt;{% endif %}</label>
                <textarea name="setting_seo_body_scripts" rows="4" class="w-full rounded-xl border-gray-200 text-sm font-mono text-xs" placeholder="<!-- Scripts a inserer avant </body> -->"></textarea>
                <p class="text-xs text-gray-500 mt-1">{% if get_locale() == 'fr' %}Ce code sera insere avant &lt;/body&gt;{% else %}This code will be inserted before &lt;/body&gt;{% endif %}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-4 border-b border-gray-100 bg-amber-50">
            <h2 class="font-semibold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                {% if get_locale() == 'fr' %}Securite{% else %}Security{% endif %}
            </h2>
        </div>
        <div class="p-5 space-y-4">
            <div class="flex items-center gap-6">
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="setting_enable_rate_limiting" checked class="rounded border-gray-300">
                    <span class="text-sm text-gray-700">{% if get_locale() == 'fr' %}Limiter le taux de requetes{% else %}Enable rate limiting{% endif %}</span>
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" name="setting_enable_ip_logging" checked class="rounded border-gray-300">
                    <span class="text-sm text-gray-700">{% if get_locale() == 'fr' %}Journaliser les IP{% else %}Log IP addresses{% endif %}</span>
                </label>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Limite par minute{% else %}Rate limit per minute{% endif %}</label>
                    <input type="number" name="setting_rate_limit_per_minute" value="60" class="w-full rounded-xl border-gray-200 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}Taille max upload (Mo){% else %}Max upload size (MB){% endif %}</label>
                    <input type="number" name="setting_max_upload_size_mb" value="5" class="w-full rounded-xl border-gray-200 text-sm">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">{% if get_locale() == 'fr' %}IPs bloquees{% else %}Blocked IPs{% endif %}</label>
                <textarea name="setting_blocked_ips" rows="2" class="w-full rounded-xl border-gray-200 text-sm font-mono text-xs" placeholder="Une IP par ligne"></textarea>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <div class="p-4 border-b border-gray-100">
            <h2 class="font-semibold text-gray-900">{% if get_locale() == 'fr' %}Informations systeme{% else %}System information{% endif %}</h2>
        </div>
        <div class="p-5 space-y-3">
            <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">{% if get_locale() == 'fr' %}Version{% else %}Version{% endif %}</span>
                <span class="font-medium text-gray-900">1.0.0</span>
            </div>
            <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">{% if get_locale() == 'fr' %}Plateforme{% else %}Platform{% endif %}</span>
                <span class="font-medium text-gray-900">Flask + PostgreSQL</span>
            </div>
            <div class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">{% if get_locale() == 'fr' %}Langues supportees{% else %}Supported languages{% endif %}</span>
                <span class="font-medium text-gray-900">Francais, English</span>
            </div>
            <div class="flex justify-between py-2">
                <span class="text-gray-600">{% if get_locale() == 'fr' %}Pays couverts{% else %}Countries covered{% endif %}</span>
                <span class="font-medium text-gray-900">54</span>
            </div>
        </div>
    </div>
    
    <div class="flex items-center justify-between">
        <a href="{{ url_for('admin.logout') }}" class="text-red-600 hover:text-red-700 text-sm font-medium flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
            {% if get_locale() == 'fr' %}Se deconnecter{% else %}Logout{% endif %}
        </a>
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2.5 rounded-xl text-sm font-medium transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
            {% if get_locale() == 'fr' %}Sauvegarder{% else %}Save{% endif %}
        </button>
    </div>
</form>
{% endblock %}
