<!--
 * Nom de l'application : DISPARUS.ORG
 * Description : Fiche detaillee d'un disparu
 * Produit de : MOA Digital Agency, www.myoneart.com
 * Fait par : Aisance KALONJI, www.aisancekalonji.com
 * Auditer par : La CyberConfiance, www.cyberconfiance.com
 -->
{% extends "base.html" %}

{% block title %}{{ person.first_name }}{% if person.person_type != 'animal' %} {{ person.last_name }}{% endif %} ({{ person.public_id }}) - {{ t('site.name') }}{% endblock %}

{% block og_type %}article{% endblock %}

{% block og_title %}{{ t('detail.title_help') }}{% endblock %}

{% block og_description %}{{ person.first_name }}{% if person.person_type != 'animal' %} {{ person.last_name }}{% endif %} - {{ person.city }}, {{ person.country }}{% endblock %}

{% block twitter_title %}{{ t('detail.title_help') }}{% endblock %}

{% block twitter_description %}{{ person.first_name }}{% if person.person_type != 'animal' %} {{ person.last_name }}{% endif %} - {{ person.city }}, {{ person.country }}{% endblock %}

{% block og_image_meta %}
{% if person.photo_url %}
<meta property="og:image" content="{{ request.url_root.rstrip('/') }}{{ person.photo_url }}">
{% elif site_settings.get('seo_og_image') %}
<meta property="og:image" content="{{ request.url_root.rstrip('/') }}{{ site_settings.get('seo_og_image') }}">
{% endif %}
{% endblock %}

{% block twitter_image_meta %}
{% if person.photo_url %}
<meta name="twitter:image" content="{{ request.url_root.rstrip('/') }}{{ person.photo_url }}">
{% elif site_settings.get('seo_og_image') %}
<meta name="twitter:image" content="{{ request.url_root.rstrip('/') }}{{ site_settings.get('seo_og_image') }}">
{% endif %}
{% endblock %}

{% block content %}
<section class="bg-gradient-to-br from-red-700 to-red-900 text-white py-12 relative overflow-hidden">
    <div class="absolute inset-0 bg-black/20"></div>
    <div class="max-w-7xl mx-auto px-4 relative z-10">
        <div class="text-center max-w-3xl mx-auto">
            <span class="inline-flex items-center gap-2 px-4 py-1.5 rounded-xl text-sm font-medium mb-4 shadow-sm
                {% if person.status == 'missing' %}bg-white text-red-700
                {% elif person.status == 'found' %}bg-green-500 text-white
                {% else %}bg-gray-500 text-white{% endif %}" data-testid="badge-status">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                {% if person.person_type == 'animal' %}
                    {% if person.status == 'missing' %}
                        {% if get_locale() == 'fr' %}Animal Disparu{% else %}Missing Animal{% endif %}
                    {% elif person.status == 'found' %}
                        {% if get_locale() == 'fr' %}Animal Retrouvé{% else %}Found Animal{% endif %}
                    {% elif person.status == 'deceased' %}
                        {% if get_locale() == 'fr' %}Animal Décédé{% else %}Deceased Animal{% endif %}
                    {% else %}
                        {{ person.status }}
                    {% endif %}
                {% else %}
                    {% if person.status == 'missing' %}
                        {{ t('detail.status_missing') }}
                    {% elif person.status == 'found' %}
                        {{ t('detail.status_found') }}
                    {% elif person.status == 'deceased' %}
                        {{ t('detail.deceased') }}
                    {% else %}
                        {{ person.status }}
                    {% endif %}
                {% endif %}
            </span>
            <h1 class="text-xl md:text-2xl font-bold mb-3 tracking-tight leading-tight" data-testid="text-person-name">
                {{ person.first_name }} {% if person.person_type != 'animal' %}{{ person.last_name }}{% endif %}
            </h1>
            <div class="w-16 h-1 bg-white/50 rounded-full mx-auto mb-4"></div>
            <p class="text-base text-red-100 opacity-90">
                {% if person.age != -1 %}{{ person.age }} {{ t('detail.age_years') }} - {% endif %}{{ person.city }}, {{ person.country }}
            </p>
            <span class="inline-block mt-3 text-xs font-mono bg-white/20 px-3 py-1 rounded-xl" data-testid="text-id">ID: {{ person.public_id }}</span>
        </div>
    </div>
</section>

<section class="py-12 bg-gray-50/50">
    <div class="max-w-6xl mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-5">
                <div class="bg-white rounded-xl border border-red-100 overflow-hidden shadow-sm">
                    <div class="aspect-video bg-gray-100 relative">
                        {% if person.photo_url %}
                        <img src="{{ person.photo_url }}" alt="{{ person.first_name }}" class="w-full h-full object-cover cursor-pointer hover:opacity-95 transition-opacity" onclick="openImageModal()">
                        {% else %}
                        <div class="absolute inset-0 flex items-center justify-center">
                            <svg class="w-24 h-24 text-gray-200" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        </div>
                        {% endif %}
                        {% if person.is_flagged %}
                        <span class="absolute top-3 right-3 bg-amber-500 text-white text-xs px-2.5 py-1 rounded-xl font-semibold">
                            {{ t('detail.flagged') }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="p-5">
                        <div class="grid grid-cols-2 gap-4 mb-5 text-sm">
                            <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                <span class="text-xs text-gray-500 font-medium">{{ t('detail.location_short') }}</span>
                                <p class="font-semibold text-gray-900 mt-1">{{ person.city }}, {{ person.country }}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                <span class="text-xs text-gray-500 font-medium">{{ t('detail.date') }}</span>
                                <p class="font-semibold text-gray-900 mt-1">{{ person.disappearance_date.strftime('%d/%m/%Y %H:%M') if person.disappearance_date else 'N/A' }}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2 text-sm flex items-center gap-2">
                                    <div class="w-1 h-4 bg-red-600 rounded-full"></div>
                                    {{ t('detail.physical_description') }}
                                </h3>
                                <p class="text-gray-600 text-sm leading-relaxed pl-3">{{ person.physical_description }}</p>
                            </div>
                            {% if person.clothing %}
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2 text-sm flex items-center gap-2">
                                    <div class="w-1 h-4 bg-red-600 rounded-full"></div>
                                    {{ t('detail.clothing') }}
                                </h3>
                                <p class="text-gray-600 text-sm leading-relaxed pl-3">{{ person.clothing }}</p>
                            </div>
                            {% endif %}
                            {% if person.objects %}
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2 text-sm flex items-center gap-2">
                                    <div class="w-1 h-4 bg-red-600 rounded-full"></div>
                                    {{ t('detail.objects') }}
                                </h3>
                                <p class="text-gray-600 text-sm leading-relaxed pl-3">{{ person.objects }}</p>
                            </div>
                            {% endif %}
                            {% if person.circumstances %}
                            <div>
                                <h3 class="font-semibold text-gray-900 mb-2 text-sm flex items-center gap-2">
                                    <div class="w-1 h-4 bg-red-600 rounded-full"></div>
                                    {{ t('detail.circumstances') }}
                                </h3>
                                <p class="text-gray-600 text-sm leading-relaxed pl-3">{{ person.circumstances }}</p>
                            </div>
                            {% endif %}
                        </div>
                        
                        {% if person.contacts %}
                        <div class="mt-5 pt-5 border-t border-gray-100">
                            <h3 class="font-semibold text-gray-900 mb-3 text-sm flex items-center gap-2">
                                <div class="w-1 h-4 bg-red-600 rounded-full"></div>
                                {{ t('detail.contact') }}
                            </h3>
                            <div class="space-y-2 pl-3">
                                {% for contact in person.contacts %}
                                <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl border border-gray-100">
                                    <div>
                                        <p class="font-medium text-gray-900 text-sm">{{ contact.name }}</p>
                                        <p class="text-xs text-gray-600">{{ contact.phone }} {% if contact.relation %}({{ contact.relation }}){% endif %}</p>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-1 h-5 bg-green-600 rounded-full"></div>
                        <h2 class="text-base font-semibold text-gray-900">{{ t('detail.download_share') }}</h2>
                    </div>
                    <div class="h-0.5 w-full bg-gradient-to-r from-green-500 via-green-300 to-transparent rounded-full mb-4"></div>
                    <div class="grid grid-cols-4 gap-3">
                        <a href="{{ url_for('public.download_pdf', public_id=person.public_id) }}" class="flex flex-col items-center gap-2 p-3 bg-red-50 hover:bg-red-100 rounded-xl border border-red-200 transition-all">
                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                            <span class="text-xs font-medium text-red-700">PDF</span>
                        </a>
                        <a href="{{ url_for('public.download_share_image', public_id=person.public_id) }}" class="flex flex-col items-center gap-2 p-3 bg-blue-50 hover:bg-blue-100 rounded-xl border border-blue-200 transition-all">
                            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <span class="text-xs font-medium text-blue-700">{{ t('detail.image') }}</span>
                        </a>
                        <a href="{{ url_for('public.download_qrcode', public_id=person.public_id) }}" class="flex flex-col items-center gap-2 p-3 bg-purple-50 hover:bg-purple-100 rounded-xl border border-purple-200 transition-all">
                            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path></svg>
                            <span class="text-xs font-medium text-purple-700">QR Code</span>
                        </a>
                        <button onclick="openShareModal()" class="flex flex-col items-center gap-2 p-3 bg-green-50 hover:bg-green-100 rounded-xl border border-green-200 transition-all">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
                            <span class="text-xs font-medium text-green-700">{{ t('detail.share') }}</span>
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-1 h-5 bg-red-600 rounded-full"></div>
                        <h2 class="text-base font-semibold text-gray-900">{{ t('detail.map_location') }}</h2>
                    </div>
                    <div class="h-0.5 w-full bg-gradient-to-r from-red-500 via-red-300 to-transparent rounded-full mb-4"></div>
                    <div id="detail-map" class="h-72 rounded-xl border border-gray-200" data-testid="map-detail"></div>
                    <div class="mt-3 flex flex-wrap gap-2 text-xs">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-red-600 rounded-full"></span> {{ t('detail.disappearance') }}</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-500 rounded-full"></span> {{ t('detail.sighting') }}</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span> {{ t('detail.found') }}</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-1 h-5 bg-red-600 rounded-full"></div>
                        <h2 class="text-base font-semibold text-gray-900">{{ t('detail.history') }} ({{ contributions|length }})</h2>
                    </div>
                    <div class="h-0.5 w-full bg-gradient-to-r from-red-500 via-red-300 to-transparent rounded-full mb-4"></div>
                    
                    {% if contributions %}
                    <div class="space-y-3">
                        {% for c in contributions %}
                        <div class="p-4 bg-gray-50 rounded-xl border-l-4 
                            {% if c.contribution_type == 'seen' %}border-blue-500
                            {% elif c.contribution_type == 'found' %}border-green-500
                            {% elif c.contribution_type == 'police' %}border-purple-500
                            {% else %}border-gray-400{% endif %}" data-testid="card-contribution-{{ c.id }}">
                            <div class="flex items-start justify-between mb-2">
                                <span class="text-xs font-medium px-2 py-0.5 rounded-lg
                                    {% if c.contribution_type == 'seen' %}bg-blue-100 text-blue-700
                                    {% elif c.contribution_type == 'found' %}bg-green-100 text-green-700
                                    {% elif c.contribution_type == 'police' %}bg-purple-100 text-purple-700
                                    {% else %}bg-gray-100 text-gray-700{% endif %}">
                                    {{ c.contribution_type }}
                                </span>
                                <span class="text-xs text-gray-500">{{ c.created_at.strftime('%d/%m/%Y %H:%M') if c.created_at else '' }}</span>
                            </div>
                            <p class="text-gray-600 text-sm">{{ c.details }}</p>
                            {% if c.location_name %}
                            <p class="text-xs text-gray-500 mt-1">{{ c.location_name }}</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-10 bg-gray-50 rounded-xl border border-gray-100">
                        <p class="text-gray-500 text-sm">{{ t('detail.no_contributions') }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="space-y-5">
                {% if person.status == 'missing' and person.disappearance_date %}
                <div class="bg-gradient-to-br from-red-600 to-red-800 rounded-xl p-5 shadow-lg text-white">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div>
                            <p class="text-red-100 text-xs uppercase tracking-wider font-medium">{{ t('detail.missing_since') }}</p>
                        </div>
                    </div>
                    <div id="missingTimer" class="flex justify-center gap-3 text-center">
                        <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 min-w-[70px]">
                            <span id="timerDays" class="text-2xl font-bold block">--</span>
                            <span class="text-xs text-red-200">{{ t('detail.days') }}</span>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 min-w-[70px]">
                            <span id="timerHours" class="text-2xl font-bold block">--</span>
                            <span class="text-xs text-red-200">{{ t('detail.hours') }}</span>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 min-w-[70px]">
                            <span id="timerMinutes" class="text-2xl font-bold block">--</span>
                            <span class="text-xs text-red-200">{{ t('detail.minutes') }}</span>
                        </div>
                    </div>
                    <p class="text-center text-red-100 text-xs mt-3">{{ t('detail.since') }} {{ person.disappearance_date.strftime('%d/%m/%Y') }} {{ t('detail.at') }} {{ person.disappearance_date.strftime('%H:%M') }}</p>
                </div>
                <script>
                (function() {
                    var disappearanceDate = new Date("{{ person.disappearance_date.strftime('%Y-%m-%dT%H:%M:%S') }}");
                    function updateTimer() {
                        var now = new Date();
                        var diff = now - disappearanceDate;
                        if (diff < 0) diff = 0;
                        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        document.getElementById('timerDays').textContent = days;
                        document.getElementById('timerHours').textContent = hours;
                        document.getElementById('timerMinutes').textContent = minutes;
                    }
                    updateTimer();
                    setInterval(updateTimer, 60000);
                })();
                </script>
                {% endif %}
                
                <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-1 h-5 bg-red-600 rounded-full"></div>
                        <h2 class="text-base font-semibold text-gray-900">{{ t('detail.add_contribution') }}</h2>
                    </div>
                    <div class="h-0.5 w-full bg-gradient-to-r from-red-500 via-red-300 to-transparent rounded-full mb-4"></div>
                    
                    <form action="/disparu/{{ person.public_id }}/contribute" method="POST" enctype="multipart/form-data" class="space-y-4">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.type') }} *</label>
                            <select name="contribution_type" required class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="select-contribution-type">
                                <option value="seen">{{ t('detail.seen_person') }}</option>
                                <option value="info">{{ t('detail.important_info') }}</option>
                                <option value="police">{{ t('detail.reported_police') }}</option>
                                <option value="found">{{ t('detail.person_found') }}</option>
                                <option value="other">{{ t('detail.other') }}</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.details') }} *</label>
                            <textarea name="details" rows="3" required class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="textarea-contribution-details"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.location_short') }}</label>
                            <input type="text" name="location_name" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="input-contribution-location">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.observation_date') }}</label>
                            <input type="datetime-local" name="observation_date" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="input-contribution-date">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.proof') }}</label>
                            <input type="file" name="proof" accept="image/*,video/*" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="input-contribution-proof">
                        </div>
                        
                        <div id="found-fields" class="hidden space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.state') }}</label>
                                <select name="person_state" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm">
                                    <option value="safe">{{ t('detail.safe') }}</option>
                                    <option value="injured">{{ t('detail.injured') }}</option>
                                    <option value="deceased">{{ t('detail.deceased') }}</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.return_circumstances') }}</label>
                                <textarea name="return_circumstances" rows="2" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm"></textarea>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.your_name') }}</label>
                            <input type="text" name="contact_name" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="input-your-name">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.your_phone') }}</label>
                            <input type="tel" name="contact_phone" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="input-your-phone">
                        </div>
                        
                        <button type="submit" class="w-full bg-red-700 hover:bg-red-800 text-white py-2.5 px-4 rounded-xl font-semibold text-sm transition-all shadow-sm hover:shadow-md" data-testid="button-submit-contribution">
                            {{ t('detail.submit_contribution') }}
                        </button>
                    </form>
                </div>
                
                <div class="bg-white rounded-xl border border-red-100 p-5 shadow-sm">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-1 h-5 bg-amber-500 rounded-full"></div>
                        <h2 class="text-base font-semibold text-gray-900">{{ t('detail.report_problem') }}</h2>
                    </div>
                    <div class="h-0.5 w-full bg-gradient-to-r from-amber-500 via-amber-300 to-transparent rounded-full mb-4"></div>
                    
                    <form action="/disparu/{{ person.public_id }}/report" method="POST" class="space-y-4">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.reason') }} *</label>
                            <select name="reason" required class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="select-report-reason">
                                <option value="false_info">{{ t('detail.false_info') }}</option>
                                <option value="duplicate">{{ t('detail.duplicate') }}</option>
                                <option value="inappropriate">{{ t('detail.inappropriate') }}</option>
                                <option value="other">{{ t('detail.other') }}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">{{ t('detail.details') }}</label>
                            <textarea name="details" rows="3" class="w-full px-4 py-2.5 border border-gray-200 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all text-sm" data-testid="textarea-report-details"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-amber-600 hover:bg-amber-700 text-white py-2.5 px-4 rounded-xl font-semibold text-sm transition-all shadow-sm hover:shadow-md" data-testid="button-submit-report">
                            {{ t('detail.report_content') }}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.querySelector('select[name="contribution_type"]').addEventListener('change', function() {
        document.getElementById('found-fields').classList.toggle('hidden', this.value !== 'found');
    });
    
    const map = L.map('detail-map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'OpenStreetMap'
    }).addTo(map);
    
    const bounds = [];
    const markers = [];
    
    const redIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #DC2626; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
        iconSize: [24, 24],
        iconAnchor: [12, 12]
    });
    
    const blueIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #3B82F6; width: 18px; height: 18px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
        iconSize: [18, 18],
        iconAnchor: [9, 9]
    });
    
    const greenIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #22C55E; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
        iconSize: [20, 20],
        iconAnchor: [10, 10]
    });
    
    {% if person.latitude and person.longitude %}
    const mainMarker = L.marker([{{ person.latitude }}, {{ person.longitude }}], {icon: redIcon}).addTo(map);
    const locLabel = {{ t("detail.location_short") | tojson }};
    const city = {{ person.city | tojson }};
    const country = {{ person.country | tojson }};
    const dateStr = {{ (person.disappearance_date.strftime("%d/%m/%Y") if person.disappearance_date else "") | tojson }};

    mainMarker.bindPopup(`<strong>${escapeHtml(locLabel)}</strong><br>${escapeHtml(city)}, ${escapeHtml(country)}<br>${escapeHtml(dateStr)}`);
    bounds.push([{{ person.latitude }}, {{ person.longitude }}]);
    markers.push(mainMarker);
    {% endif %}
    
    {% for c in contributions %}
    {% if c.latitude and c.longitude %}
    (function() {
        const contributionType = {{ c.contribution_type | tojson }};
        const icon = contributionType === 'found' ? greenIcon : blueIcon;
        const marker = L.marker([{{ c.latitude }}, {{ c.longitude }}], {icon: icon}).addTo(map);

        const typeLabel = {
            'seen': {{ t("detail.sighting") | tojson }},
            'found': {{ t("detail.person_found") | tojson }},
            'info': {{ t("detail.important_info") | tojson }},
            'police': {{ t("detail.police") | tojson }},
            'other': {{ t("detail.other") | tojson }}
        }[contributionType] || contributionType;

        const locationName = {{ (c.location_name or "") | tojson }};
        const createdAt = {{ (c.created_at.strftime("%d/%m/%Y %H:%M") if c.created_at else "") | tojson }};

        marker.bindPopup(`<strong>${escapeHtml(typeLabel)}</strong><br>${escapeHtml(locationName)}<br>${escapeHtml(createdAt)}`);
        bounds.push([{{ c.latitude }}, {{ c.longitude }}]);
        markers.push(marker);
    })();
    {% endif %}
    {% endfor %}
    
    if (bounds.length > 0) {
        if (bounds.length === 1) {
            map.setView(bounds[0], 20);
        } else {
            map.fitBounds(bounds, {padding: [30, 30], maxZoom: 20});
        }
    } else {
        map.setView([0, 20], 3);
    }
    
    if (markers.length > 0) {
        markers[0].openPopup();
    }
</script>

<div id="imageModal" class="fixed inset-0 bg-black/95 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm" style="background-color: rgba(0, 0, 0, 0.95);">
    <button onclick="closeImageModal()" class="absolute top-4 right-4 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white transition-colors z-[101]">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
    <div class="w-full h-full flex items-center justify-center" onclick="closeImageModal()">
        <img id="fullScreenImage" src="{{ person.photo_url }}" alt="{{ person.first_name }}" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl" onclick="event.stopPropagation()">
    </div>
</div>

<div id="shareModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto shadow-2xl">
        <div class="sticky top-0 bg-white border-b border-gray-100 p-4 flex items-center justify-between rounded-t-2xl">
            <h3 class="text-lg font-semibold text-gray-900">{{ t('detail.share') }}</h3>
            <button onclick="closeShareModal()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div class="p-4 grid grid-cols-4 gap-3">
            <button onclick="copyLink()" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">{{ t('detail.copy') }}</span>
            </button>
            <a href="sms:?body={{ t('detail.title_help') ~ ' ' ~ person.first_name ~ ' ' ~ person.last_name ~ ' - ' ~ request.url | urlencode }}" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">SMS</span>
            </a>
            <a href="https://wa.me/?text={{ t('detail.title_help') ~ ' ' ~ person.first_name ~ ' ' ~ person.last_name ~ ' - ' ~ request.url | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">WA Business</span>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">Facebook</span>
            </a>
            <a href="https://twitter.com/intent/tweet?text={{ t('detail.title_help') ~ ' ' ~ person.first_name ~ ' ' ~ person.last_name | urlencode }}&url={{ request.url | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-black rounded-full flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">X</span>
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.url | urlencode }}&title={{ t('detail.title_help') | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-blue-700 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">LinkedIn</span>
            </a>
            <a href="https://t.me/share/url?url={{ request.url | urlencode }}&text={{ t('detail.title_help') ~ ' ' ~ person.first_name ~ ' ' ~ person.last_name | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-sky-500 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">Telegram</span>
            </a>
            <a href="mailto:?subject={{ t('detail.title_help') | urlencode }}&body={{ person.first_name ~ ' ' ~ person.last_name ~ ' - ' ~ request.url | urlencode }}" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">Email</span>
            </a>
            <a href="https://www.messenger.com/t/?link={{ request.url | urlencode }}" target="_blank" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 4.974 0 11.111c0 3.498 1.744 6.614 4.469 8.654V24l4.088-2.242c1.092.301 2.246.464 3.443.464 6.627 0 12-4.975 12-11.111C24 4.974 18.627 0 12 0zm1.191 14.963l-3.055-3.26-5.963 3.26L10.732 8l3.131 3.259L19.752 8l-6.561 6.963z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">Messenger</span>
            </a>
            <a href="viber://forward?text={{ t('detail.title_help') ~ ' ' ~ person.first_name ~ ' ' ~ person.last_name ~ ' - ' ~ request.url | urlencode }}" class="flex flex-col items-center gap-2 p-3 hover:bg-gray-50 rounded-xl transition-colors">
                <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M11.398.002C9.473.028 5.331.344 3.014 2.467 1.294 4.182.518 6.793.377 10.079c-.142 3.286-.053 6.493.329 7.806.692 2.388 2.984 4.254 6.547 4.73l.053-.002v2.168s-.036.872.542 1.05c.698.215 1.108-.449 1.775-1.166.367-.394.871-.971 1.252-1.412 3.451.29 6.106-.373 6.406-.477.693-.24 4.61-.726 5.248-5.93.658-5.364-.316-8.756-2.068-10.294l-.006-.006c-.508-.466-2.541-1.972-7.271-2.082 0 0-.355-.016-.786-.012zm.098 1.704h.643c3.944.091 5.672 1.295 6.073 1.666 1.385 1.234 2.206 4.086 1.638 8.625-.518 4.186-3.594 4.483-4.15 4.674-.247.08-2.493.637-5.397.467 0 0-2.139 2.575-2.806 3.246-.105.107-.229.149-.31.13-.115-.027-.148-.158-.147-.35l.018-3.506s-.025-.002-.063-.006c-2.922-.387-4.857-1.853-5.424-3.812-.31-1.08-.4-3.907-.274-6.827.127-2.921.786-5.085 2.191-6.481 1.864-1.7 5.167-1.863 7.008-1.826zm.533 2.727c-.148 0-.266.118-.267.266v.002c0 .148.118.267.266.267.772 0 1.58.128 2.236.426 1.308.593 1.966 1.633 2.107 3.369.014.147.138.26.285.26h.006c.148-.01.26-.142.246-.29-.161-1.95-.944-3.187-2.467-3.878-.763-.347-1.664-.49-2.412-.422zm-3.146.555c-.37-.004-.742.061-1.008.2-.482.255-.791.59-.9 1.155-.18.884.316 1.615.93 2.22l.006.006c.289.286.588.561.863.86.29.317.556.657.793 1.016.593.886.938 1.95 1.438 2.893.238.453.51.888.847 1.27.507.573 1.155.996 1.924 1.03.41.016.802-.136 1.043-.476.233-.328.37-.727.403-1.123.03-.365-.14-.72-.426-.948-.307-.24-.631-.458-.962-.666-.412-.258-.839-.479-1.214-.79-.233-.19-.51-.305-.803-.347-.242-.036-.48.014-.691.128-.254.138-.466.337-.7.506-.204.146-.402.323-.652.387-.247.062-.5-.032-.689-.19-.414-.346-.776-.776-1.097-1.197-.312-.412-.577-.856-.82-1.31-.2-.377-.367-.77-.594-1.13-.175-.275-.378-.532-.623-.741-.269-.228-.622-.332-.963-.316-.103.005-.2.08-.231.179-.03.092.012.188.096.237.253.149.476.34.675.56.26.288.463.621.634.968.114.233.216.472.336.702.245.462.533.9.853 1.312.305.394.631.776 1.002 1.107.248.22.523.415.84.52.268.087.547.086.811-.013.371-.14.67-.407.978-.645.121-.094.246-.19.398-.223.112-.025.229-.003.328.054.337.191.642.43.962.648.295.198.596.387.877.607.117.09.179.241.163.388-.03.309-.123.607-.283.871-.108.181-.302.284-.509.271-.585-.033-1.077-.363-1.457-.793-.284-.32-.51-.688-.72-1.068-.48-.869-.822-1.891-1.374-2.71-.21-.31-.44-.607-.7-.877-.296-.308-.608-.6-.913-.899l-.009-.007c-.49-.488-.872-1.03-.754-1.614.07-.35.28-.565.628-.75.187-.098.479-.144.769-.148zm3.016.652c-.108-.001-.214.04-.295.114-.083.076-.132.183-.133.296-.002.148.1.277.244.308.614.122 1.127.379 1.537.77.504.48.773 1.123.868 1.896.018.145.139.255.285.26h.011c.147-.005.264-.125.265-.274.002-.048-.013-.264-.04-.449-.076-.5-.244-.952-.512-1.359-.448-.68-1.13-1.162-2.004-1.466-.075-.026-.152-.069-.226-.096zm-.126 1.475c-.148-.008-.275.106-.283.254-.007.147.106.273.254.282.349.022.626.137.845.352.257.252.387.607.42.996.008.148.132.263.28.262h.017c.148-.01.262-.136.254-.283-.044-.536-.224-1.015-.572-1.359-.303-.298-.703-.469-1.196-.504h-.019z"/></svg>
                </div>
                <span class="text-xs text-gray-600 font-medium">Pinterest</span>
            </a>
        </div>
        <div id="copySuccess" class="hidden mx-4 mb-4 p-3 bg-green-50 border border-green-200 rounded-xl text-green-700 text-sm text-center">
            {{ t('detail.link_copied') }}
        </div>
    </div>
</div>

<script>
function openShareModal() {
    document.getElementById('shareModal').classList.remove('hidden');
    document.getElementById('shareModal').classList.add('flex');
    document.body.style.overflow = 'hidden';
}

function closeShareModal() {
    document.getElementById('shareModal').classList.add('hidden');
    document.getElementById('shareModal').classList.remove('flex');
    document.body.style.overflow = 'auto';
}

function copyLink() {
    navigator.clipboard.writeText(window.location.href).then(function() {
        document.getElementById('copySuccess').classList.remove('hidden');
        setTimeout(function() {
            document.getElementById('copySuccess').classList.add('hidden');
        }, 2000);
    });
}

document.getElementById('shareModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeShareModal();
    }
});

function openImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = 'auto';
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeImageModal();
        closeShareModal();
    }
});
</script>
{% endblock %}
