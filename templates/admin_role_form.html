<!--
Nom de l'application : DISPARUS.ORG
Description : Plateforme citoyenne de signalement de personnes disparues en Afrique
Produit de : MOA Digital Agency, www.myoneart.com
Fait par : Aisance KALONJI, www.aisancekalonji.com
Auditer par : La CyberConfiance, www.cyberconfiance.com
-->

{% extends "admin_base.html" %}

{% block title %}{% if role %}{% if get_locale() == 'fr' %}Modifier{% else %}Edit{% endif %}{% else %}{% if get_locale() == 'fr' %}Ajouter{% else %}Add{% endif %}{% endif %} {% if get_locale() == 'fr' %}Role{% else %}Role{% endif %} - Admin DISPARUS.ORG{% endblock %}

{% block page_title %}{% if role %}{% if get_locale() == 'fr' %}Modifier le role{% else %}Edit role{% endif %}{% else %}{% if get_locale() == 'fr' %}Nouveau role{% else %}New role{% endif %}{% endif %}{% endblock %}
{% block page_subtitle %}{% if role %}{{ role.display_name }}{% else %}{% if get_locale() == 'fr' %}Creer un nouveau role{% else %}Create a new role{% endif %}{% endif %}{% endblock %}

{% block admin_content %}
<div class="max-w-2xl">
    <form method="POST" class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="p-6 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-1">
                    <label class="block text-sm font-medium text-gray-700">{% if get_locale() == 'fr' %}Identifiant{% else %}ID{% endif %} <span class="text-red-500">*</span></label>
                    <input type="text" name="name" value="{{ role.name if role else '' }}" required {% if role and role.is_system %}readonly{% endif %} 
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-500 transition-all {% if role and role.is_system %}bg-gray-100 cursor-not-allowed{% endif %}" 
                        placeholder="{% if get_locale() == 'fr' %}ex: moderator{% else %}e.g. moderator{% endif %}">
                    {% if role and role.is_system %}
                    <p class="text-xs text-gray-500 mt-1">{% if get_locale() == 'fr' %}Role systeme - identifiant non modifiable{% else %}System role - ID cannot be changed{% endif %}</p>
                    {% endif %}
                </div>
                <div class="space-y-1">
                    <label class="block text-sm font-medium text-gray-700">{% if get_locale() == 'fr' %}Nom affiche{% else %}Display name{% endif %} <span class="text-red-500">*</span></label>
                    <input type="text" name="display_name" value="{{ role.display_name if role else '' }}" required 
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-500 transition-all" 
                        placeholder="{% if get_locale() == 'fr' %}ex: Moderateur{% else %}e.g. Moderator{% endif %}">
                </div>
            </div>
            
            <div class="space-y-1">
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea name="description" rows="2" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-red-200 focus:border-red-500 transition-all resize-none"
                    placeholder="{% if get_locale() == 'fr' %}Decrivez le role et ses responsabilites...{% else %}Describe the role and its responsibilities...{% endif %}">{{ role.description if role else '' }}</textarea>
            </div>
            
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">{% if get_locale() == 'fr' %}Menus accessibles{% else %}Accessible menus{% endif %}</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                    {% set menus = [
                        ('dashboard', 'Tableau de bord' if get_locale() == 'fr' else 'Dashboard'),
                        ('reports', 'Signalements' if get_locale() == 'fr' else 'Reports'),
                        ('moderation', 'Moderation'),
                        ('contributions', 'Contributions'),
                        ('statistics', 'Statistiques' if get_locale() == 'fr' else 'Statistics'),
                        ('map', 'Carte' if get_locale() == 'fr' else 'Map'),
                        ('users', 'Utilisateurs' if get_locale() == 'fr' else 'Users'),
                        ('roles', 'Roles'),
                        ('logs', 'Logs'),
                        ('downloads', 'Telechargements' if get_locale() == 'fr' else 'Downloads'),
                        ('settings', 'Parametres' if get_locale() == 'fr' else 'Settings')
                    ] %}
                    {% for menu_id, menu_label in menus %}
                    <label class="flex items-center gap-3 p-3 bg-gray-50 hover:bg-gray-100 rounded-xl cursor-pointer transition-colors border border-gray-100">
                        <input type="checkbox" name="menu_access" value="{{ menu_id }}" {% if role and menu_id in (role.menu_access or []) %}checked{% endif %} 
                            class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500">
                        <span class="text-sm text-gray-700">{{ menu_label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">Permissions</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    {% set perms = [
                        ('manage_users', 'Gerer utilisateurs' if get_locale() == 'fr' else 'Manage users'),
                        ('manage_roles', 'Gerer roles' if get_locale() == 'fr' else 'Manage roles'),
                        ('manage_settings', 'Gerer parametres' if get_locale() == 'fr' else 'Manage settings'),
                        ('manage_reports', 'Gerer signalements' if get_locale() == 'fr' else 'Manage reports'),
                        ('manage_contributions', 'Gerer contributions' if get_locale() == 'fr' else 'Manage contributions'),
                        ('view_logs', 'Voir logs' if get_locale() == 'fr' else 'View logs'),
                        ('view_downloads', 'Voir telechargements' if get_locale() == 'fr' else 'View downloads'),
                        ('moderate_content', 'Moderer contenu' if get_locale() == 'fr' else 'Moderate content'),
                        ('delete_content', 'Supprimer contenu' if get_locale() == 'fr' else 'Delete content'),
                        ('export_data', 'Exporter donnees' if get_locale() == 'fr' else 'Export data')
                    ] %}
                    {% for perm_id, perm_label in perms %}
                    <label class="flex items-center gap-3 p-3 bg-gray-50 hover:bg-gray-100 rounded-xl cursor-pointer transition-colors border border-gray-100">
                        <input type="checkbox" name="perm_{{ perm_id }}" {% if role and role.permissions and role.permissions.get(perm_id) %}checked{% endif %} 
                            class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500">
                        <span class="text-sm text-gray-700">{{ perm_label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-white border-t border-gray-100 flex items-center justify-between">
            <a href="{{ url_for('admin.roles') }}" class="px-4 py-2.5 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-xl text-sm font-medium transition-all">
                {% if get_locale() == 'fr' %}Annuler{% else %}Cancel{% endif %}
            </a>
            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2.5 rounded-xl text-sm font-semibold transition-all shadow-sm hover:shadow flex items-center gap-2">
                {% if role %}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                {% if get_locale() == 'fr' %}Mettre a jour{% else %}Update{% endif %}
                {% else %}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                {% if get_locale() == 'fr' %}Creer{% else %}Create{% endif %}
                {% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
