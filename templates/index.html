{% extends "base.html" %}

{% block title %}DISPARUS.ORG - {% if get_locale() == 'fr' %}Retrouver les disparus{% else %}Find the Missing{% endif %}{% endblock %}

{% block content %}
<section class="py-12 md:py-20 px-4 bg-gradient-to-b from-red-50 to-transparent dark:from-red-900/10">
    <div class="max-w-7xl mx-auto text-center space-y-6">
        <h1 class="text-3xl md:text-5xl font-bold leading-tight" data-testid="text-hero-title">
            {% if get_locale() == 'fr' %}
            Ensemble, retrouvons nos disparus
            {% else %}
            Together, let's find our missing
            {% endif %}
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto" data-testid="text-hero-subtitle">
            {% if get_locale() == 'fr' %}
            Plateforme citoyenne de signalement et de recherche de personnes disparues en Afrique
            {% else %}
            Citizen platform for reporting and searching for missing persons in Africa
            {% endif %}
        </p>
        
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 pt-4">
            <a href="/signaler" class="inline-flex items-center gap-2 bg-primary text-white px-6 py-3 rounded-md font-medium hover:bg-red-700 transition-colors" data-testid="button-report-hero">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                {% if get_locale() == 'fr' %}Signaler une disparition{% else %}Report Missing Person{% endif %}
            </a>
            <a href="/recherche" class="inline-flex items-center gap-2 border border-gray-300 dark:border-gray-600 px-6 py-3 rounded-md font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" data-testid="button-search-hero">
                {% if get_locale() == 'fr' %}Rechercher{% else %}Search{% endif %}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
            </a>
        </div>
    </div>
</section>

<section class="py-8 px-4 -mt-8">
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700">
                <div class="text-3xl font-bold text-primary">{{ stats.total }}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {% if get_locale() == 'fr' %}Personnes recherchées{% else %}Missing Persons{% endif %}
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700">
                <div class="text-3xl font-bold text-green-600">{{ stats.found }}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {% if get_locale() == 'fr' %}Retrouvées{% else %}Found{% endif %}
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700">
                <div class="text-3xl font-bold text-blue-600">{{ stats.countries }}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {% if get_locale() == 'fr' %}Pays couverts{% else %}Countries{% endif %}
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700">
                <div class="text-3xl font-bold text-purple-600">{{ stats.contributions }}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    {% if get_locale() == 'fr' %}Contributions{% else %}Contributions{% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-8 px-4">
    <div class="max-w-7xl mx-auto">
        <h2 class="text-2xl font-semibold mb-6">
            {% if get_locale() == 'fr' %}Carte des disparitions{% else %}Missing Persons Map{% endif %}
        </h2>
        <div id="map" class="h-80 md:h-96 rounded-lg border border-gray-200 dark:border-gray-700"></div>
    </div>
</section>

<section class="py-12 px-4">
    <div class="max-w-7xl mx-auto">
        <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
            <h2 class="text-2xl font-semibold">
                {% if get_locale() == 'fr' %}Personnes recherchées{% else %}Missing Persons{% endif %}
            </h2>
            <a href="/recherche" class="inline-flex items-center gap-2 text-primary hover:underline">
                {% if get_locale() == 'fr' %}Voir plus{% else %}View more{% endif %}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
            </a>
        </div>
        
        {% if disparus %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for person in disparus %}
            <a href="/disparu/{{ person.public_id }}" class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-lg transition-shadow" data-testid="card-person-{{ person.public_id }}">
                <div class="aspect-square bg-gray-200 dark:bg-gray-700 relative">
                    {% if person.photo_url %}
                    <img src="{{ person.photo_url }}" alt="{{ person.first_name }}" class="w-full h-full object-cover">
                    {% else %}
                    <div class="absolute inset-0 flex items-center justify-center">
                        <svg class="w-24 h-24 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                    {% endif %}
                    
                    {% if person.status == 'missing' %}
                    <span class="absolute top-2 right-2 bg-primary text-white text-xs px-2 py-1 rounded">
                        {% if get_locale() == 'fr' %}Recherché{% else %}Missing{% endif %}
                    </span>
                    {% elif person.status == 'found' %}
                    <span class="absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded">
                        {% if get_locale() == 'fr' %}Retrouvé{% else %}Found{% endif %}
                    </span>
                    {% endif %}
                </div>
                <div class="p-4">
                    <div class="flex items-start justify-between gap-2">
                        <div>
                            <h3 class="font-semibold">{{ person.first_name }} {{ person.last_name }}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">{{ person.age }} {% if get_locale() == 'fr' %}ans{% else %}years{% endif %}</p>
                        </div>
                        <span class="text-xs text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded font-mono">{{ person.public_id }}</span>
                    </div>
                    <div class="flex items-center gap-1 mt-2 text-sm text-gray-500 dark:text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                        {{ person.city }}, {{ person.country }}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
            <p>{% if get_locale() == 'fr' %}Aucun résultat{% else %}No results{% endif %}</p>
            <a href="/signaler" class="inline-block mt-4 bg-primary text-white px-4 py-2 rounded-md">
                {% if get_locale() == 'fr' %}Signaler une disparition{% else %}Report Missing Person{% endif %}
            </a>
        </div>
        {% endif %}
    </div>
</section>

<section class="py-12 px-4 bg-gray-100 dark:bg-gray-800/50">
    <div class="max-w-7xl mx-auto">
        <h2 class="text-2xl font-semibold text-center mb-8">
            {% if get_locale() == 'fr' %}Comment aider ?{% else %}How to Help?{% endif %}
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <a href="/signaler" class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                    <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                </div>
                <h3 class="font-semibold text-lg mb-2">{% if get_locale() == 'fr' %}Signaler{% else %}Report{% endif %}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    {% if get_locale() == 'fr' %}Signalez une personne disparue en quelques étapes{% else %}Report a missing person in a few steps{% endif %}
                </p>
            </a>
            
            <a href="/recherche" class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </div>
                <h3 class="font-semibold text-lg mb-2">{% if get_locale() == 'fr' %}Contribuer{% else %}Contribute{% endif %}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    {% if get_locale() == 'fr' %}Signalez un témoignage ou une observation{% else %}Report a sighting or testimony{% endif %}
                </p>
            </a>
            
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center border border-gray-200 dark:border-gray-700">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                </div>
                <h3 class="font-semibold text-lg mb-2">{% if get_locale() == 'fr' %}Partager{% else %}Share{% endif %}</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    {% if get_locale() == 'fr' %}Partagez les avis de recherche sur les réseaux{% else %}Share missing person alerts on social media{% endif %}
                </p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    const markers = {{ markers | tojson | safe }};
    
    const map = L.map('map').setView([5.95, 10.15], 4);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    
    const redIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #b91c1c; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
    });
    
    markers.forEach(m => {
        const marker = L.marker([m.lat, m.lng], { icon: redIcon }).addTo(map);
        marker.bindPopup(`<a href="/disparu/${m.id}" class="font-medium hover:underline">${m.name}</a>`);
    });
</script>
{% endblock %}
